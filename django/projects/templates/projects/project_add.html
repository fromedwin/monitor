{% extends 'application.html' %}

{% block html_head_title %}Projects - FromEdwin{% endblock %}

{% block content %}
<form id="form" onSubmit="return onSubmit();" method="POST" class="space-y-8 divide-y divide-gray-200">
  <div class="space-y-8 divide-y divide-gray-200 sm:space-y-5">
    <div>
      <div>
        <h3 class="title_add text-lg leading-6 font-medium text-gray-900">
          New project
        </h3>
      </div>

      <div class="mt-6 sm:mt-5 space-y-6 sm:space-y-5">
        <div class="sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
          <label for="{{ form.url.id_for_label }}" class="block text-sm font-medium text-gray-700 sm:mt-px sm:pt-2">
            {{ form.url.label }}
          </label>
          <div class="mt-1 sm:mt-0 sm:col-span-2">
            <input type="text" {% if form.url.value %}value="{{ form.url.value }}"{% endif %} name="{{ form.url.html_name }}" id="{{ form.url.id_for_label }}" class="max-w-lg block w-full shadow-sm focus:ring-green-500 focus:border-green-500 sm:max-w-xs sm:text-sm border-gray-300 rounded-md">
            {% if form.url.errors %}
              {% for error in form.url.errors %}
              <p class="mt-2 text-sm text-red-500">{{ error|escape }}</p>
              {% endfor %}
            {% endif %}
          </div>
        </div>
      </div>
      {% csrf_token %}
    </div>
  </div>

  <div id="loading"> 
    
  </div>

  <div class="pt-5 flex justify-between">
    <div class="flex justify-end">
      <a href="{% if application %}{% url 'project' application.id %}{% else %}{% url 'projects' %}{% endif %}" class="bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
        Cancel
      </a>
      <button type="submit" class="ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
        Create
      </button>
    </div>
  </div>
</form>

{% endblock %}


{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js" crossorigin="anonymous"></script>
<script>
  function onSubmit() {

    document.getElementById('form').classList.add('loading');
    startLoadingAnimation();
    // Show loading animation
    setTimeout(() => {
      window.location.href = '{% url 'projects' %}';
    }, 3000);

    // Disable default onSubmit event
    // return false;
  }

  function startLoadingAnimation() {

    var myChart = echarts.init(document.getElementById('loading'), null, {
      renderer: 'svg'
    });
    myChart.setOption({
      graphic: {
        elements: [
          {
            type: 'group',
            left: 'center',
            top: 'center',
            children: new Array(7).fill(0).map((val, i) => ({
              type: 'rect',
              x: i * 20,
              shape: {
                x: 0,
                y: -40,
                width: 10,
                height: 80
              },
              style: {
                fill: 'rgb(5, 150, 105)'
              },
              keyframeAnimation: {
                duration: 1000,
                delay: i * 200,
                loop: true,
                keyframes: [
                  {
                    percent: 0.5,
                    scaleY: 0.3,
                    easing: 'cubicIn'
                  },
                  {
                    percent: 1,
                    scaleY: 1,
                    easing: 'cubicOut'
                  }
                ]
              }
            }))
          }
        ]
      }});
  }
</script>
{% endblock %}

{% block css %}
<style>
  form {

  }

  #loading {
    visibility: hidden;
  }

  form.loading #loading {
    visibility: visible;
    height: 200px;
  }
</style>
{% endblock %}
