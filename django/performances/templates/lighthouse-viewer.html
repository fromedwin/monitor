{% extends 'projects/project_view.html' %}
{% load static socialaccount account tailwind_tags fromedwin_tags %}

{% block html_head_title %}Report - {{ project.title }} - FromEdwin{% endblock %}

{% block javascript %}
<!-- <script src="{% static 'lighthouse-viewer/lighthouse-viewer-no-dark-mode.umd.js' %}"></script> -->
{% endblock %}

{% block subsection %}

<div class="p-4">
    <div class="pb-5 border-b border-gray-200 sm:flex sm:items-center sm:justify-between">
      <h3 class="text-lg leading-6 font-medium text-gray-900">
        Report ()
      </h3>
      <div class="mt-3 sm:mt-0 sm:ml-4">
        {% if report.performance.request_run %}
        <div disabled="disabled" class="inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium leading-4 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 opacity-40">Waiting</div>
        {% else %}
        <div class="inline-flex mt-2 flex items-center text-sm text-gray-500 px-2">
          {{ report.creation_date|timesince}} ago
        </div>
        <a href="{% url 'performance_rerun' project.id report.performance.id %}" class="inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium leading-4 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">Request new run</a>
        {% endif %}
        <a href="{{ report.report_json_file.url }}" class="inline-flex items-center rounded-md border border-transparent bg-green-100 px-3 py-2 text-sm font-medium leading-4 text-green-700 hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">See JSON</a>
      </div>
    </div>
    
    <main id="lighthouse-viewer-element"></main>

    <script src="{% static 'lighthouse-viewer/lighthouse-viewer-no-dark-mode.umd.js' %}"></script>
    <script>
      var json = {{ json|safe }};
      const app = document.getElementById('lighthouse-viewer-element');
      const reportHtml = LighthouseViewer.renderReport(json, { omitTopbar: true });
      app.appendChild(reportHtml);
    </script>
</div>
{% endblock %}
