{% extends 'application.html' %}
{% load static socialaccount account tailwind_tags fromedwin_tags humanize %}

{% block html_head_title %}Graph - {{ project.title }} - FromEdwin{% endblock %}

{% block content %}

{% block javascript %}
<script src="{% static 'echarts/echarts.min.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);
        var option;
        myChart.showLoading();

        // Fetch tree data from API
        fetch(`/api/project/{{ project.id }}/pages/tree/`)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                myChart.setOption(
                    (option = {
                        tooltip: {
                            trigger: 'item',
                            triggerOn: 'mousemove'
                        },
                        series: [
                            {
                                type: 'tree',
                                data: [data],
                                top: '1%',
                                left: '7%',
                                bottom: '1%',
                                right: '20%',
                                symbolSize: 7,
                                label: {
                                    position: 'left',
                                    verticalAlign: 'middle',
                                    align: 'right',
                                    fontSize: 9
                                },
                                leaves: {
                                    label: {
                                        position: 'right',
                                        verticalAlign: 'middle',
                                        align: 'left'
                                    }
                                },
                                emphasis: {
                                    focus: 'descendant'
                                },
                                expandAndCollapse: true,
                                animationDuration: 550,
                                animationDurationUpdate: 750
                            }
                        ]
                    })
                );
                myChart.hideLoading();
            })
            .catch(error => {
                console.error('Error fetching tree data:', error);
                myChart.hideLoading();
            });
    });
</script>
{% endblock %}

{% block subsection %}
<div class="pl-4 pr-4 flex flex-col gap-4">

    <div class="pb-5 sm:flex sm:items-center sm:justify-between">
        <a href="{% url 'project_pages' project.id %}"
            class="inline-flex items-center bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
            <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
            </svg> Back to performances
        </a>
    </div>

    <div id="main" class="w-full h-[80vh]"></div>
</div>
{% endblock %}

{% endblock %}